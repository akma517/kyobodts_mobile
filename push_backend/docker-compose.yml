version: '3.8'

services:
  kyobodts-push-server:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: kyobodts-push-server
    ports:
      - "5000:5000"
    environment:
      - FLASK_ENV=production
      - FLASK_DEBUG=False
      # ğŸ” ë³´ì•ˆ ê°•í™”: í™˜ê²½ë³€ìˆ˜ë¡œ Firebase í‚¤ ì „ë‹¬
      - FIREBASE_SERVICE_ACCOUNT_BASE64=${FIREBASE_SERVICE_ACCOUNT_BASE64}
    volumes:
      # ë¡œê·¸ íŒŒì¼ì„ í˜¸ìŠ¤íŠ¸ì— ë§ˆìš´íŠ¸ (ì„ íƒì‚¬í•­)
      - ./logs:/app/logs
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

# ğŸš€ AWS ë°°í¬ìš© ì„œë¹„ìŠ¤ (ì´ë¯¸ì§€ ê¸°ë°˜)
  push-backend:
    image: akma517/kyobodts-push-backend
    container_name: kyobodts-push-backend
    ports:
      - "5001:5000"  # í¬íŠ¸ ì¶©ëŒ ë°©ì§€
    environment:
      - FIREBASE_SERVICE_ACCOUNT_BASE64=${FIREBASE_SERVICE_ACCOUNT_BASE64}
    restart: unless-stopped
    profiles:
      - production  # docker-compose --profile production up -d